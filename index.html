<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inquiry Portal</title>
</head>
<body style="font-family:Arial, Helvetica, sans-serif; background:#f5f7fa; margin:0; padding:0;">

  <!-- ===== Navigation Bar ===== -->
<nav style="display:flex; justify-content:center; gap:20px; padding:18px; background:#fff; border-bottom:1px solid #ddd; box-shadow:0 2px 6px rgba(0,0,0,0.05);">
  <button 
    onclick="setActiveButton('submitBtn'); showSection('submit');" 
    id="submitBtn"
    style="background:#0066bf; color:#fff; border:none; padding:12px 22px; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.25s ease; box-shadow:0 2px 4px rgba(0,0,0,0.1);"
    onmouseover="if(this.style.background!=='rgb(0, 102, 191)'){this.style.background='#e0e0e0';}"
    onmouseout="if(this.style.background!=='rgb(0, 102, 191)'){this.style.background='#f4f4f4';}"
  >
    Submit Inquiry
  </button>

  <button 
    onclick="setActiveButton('followBtn'); showSection('followup');" 
    id="followBtn"
    style="background:#f4f4f4; color:#333; border:none; padding:12px 22px; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.25s ease; box-shadow:0 2px 4px rgba(0,0,0,0.08);"
    onmouseover="if(this.style.background!=='rgb(0, 102, 191)'){this.style.background='#e0e0e0';}"
    onmouseout="if(this.style.background!=='rgb(0, 102, 191)'){this.style.background='#f4f4f4';}"
  >
    Follow Up Inquiry
  </button>
</nav>

  <!-- ===== Header ===== -->
  <header style="
    color:#000;
    text-align:center;
    padding:32px 12px;
    font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-weight:800;
    font-size:32px;
    letter-spacing:1.5px;
    text-transform:uppercase;
    background:transparent;
  ">
    Inquiry Portal
    <div style="
      width:140px;
      height:4px;
      background:linear-gradient(90deg, #0066bf, #00aaff);
      margin:14px auto 0;
      border-radius:2px;
      box-shadow:0 2px 6px rgba(0,102,191,0.4);
    "></div>
  </header>

  <!-- ===== Main Sections ===== -->
  <main style="padding:24px;">
    <!-- === Submit Form Section === -->
    <div id="submitSection">
      <form id="inquiryForm" style="background:#fff; max-width:900px; margin:0 auto; padding:22px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08);">
        <!-- Student ID -->
        <label style="display:block; font-weight:600; margin-top:12px;">Student University ID</label>
        <input id="studentId" name="studentId" required
              style="width:100%; box-sizing:border-box; padding:10px 12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

        <!-- Contact number -->
        <label style="display:block; font-weight:600; margin-top:12px;">Student Contact Number</label>
        <input id="contact" name="contact" required
              style="width:100%; box-sizing:border-box; padding:10px 12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

        <!-- Graduate? -->
        <label style="display:block; font-weight:600; margin-top:12px;">Graduate Student?</label>
        <select id="graduate" name="graduate" required
                style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

        <!-- Registered min 12 hours? -->
        <label style="display:block; font-weight:600; margin-top:12px;">Have you registered minimum 12 hours this semester?</label>
        <select id="registered12" name="registered12" required
                style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
          <option value="">Select</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

        <!-- Category -->
        <label style="display:block; font-weight:600; margin-top:12px;">Inquiry Category</label>
        <select id="category" name="category" required onchange="showFollowupQuestions()"
                style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
          <option value="">Select</option>
          <option value="Adding_Course">Adding Course(s)</option>
          <option value="Section_Change">Change Section</option>
          <option value="Diploma_Program">Diploma Program</option>
          <option value="Exam_Retake">Exam Retake</option>
          <option value="Industrial_Training">Industrial Training Grade</option>
          <option value="Senior_Project">Senior Project</option>
          <option value="Others">Other Inquiries</option>
        </select>

        <!-- Container for conditional follow-up questions -->
        <div id="extraQuestions" style="margin-top:14px;"></div>

        <!-- Issue details -->
        <label style="display:block; font-weight:600; margin-top:12px;">Issue Details</label>
        <textarea id="details" name="details" rows="4"
                  style="width:100%;box-sizing:border-box; padding:10px 12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;"
                  placeholder="Describe your issue..."></textarea>

        <!-- Submit -->
        <button type="submit"
                style="background:#0066bf; color:#fff; border:none; padding:10px 18px; border-radius:8px; margin-top:18px; cursor:pointer; font-weight:600;">
          Submit Inquiry
        </button>

        <p id="statusMsg" style="margin-top:12px; font-size:14px;"></p>
      </form>
    </div>

    <!-- === Follow-Up Section === -->
    <div id="followupSection" style="display:none; text-align:center;">
      <div style="background:#fff; max-width:600px; margin:0 auto; padding:30px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08);">
        <h2 style="font-size:22px; margin-bottom:12px;">Follow Up Inquiry</h2>
        <p>Enter your Student ID to check your inquiry status.</p>
        <input id="followId" type="text" placeholder="Enter Student ID"
              style="width:80%; max-width:400px; padding:10px 12px; border:1px solid #ccc; border-radius:6px; font-size:15px; margin-top:10px;">
        <button onclick="checkStatus()" style="background:#0066bf; color:white; border:none; padding:10px 18px; border-radius:6px; font-weight:600; margin-top:10px; cursor:pointer;">Check Status</button>

        <div id="followupResult" style="margin-top:20px; text-align:left;"></div>
      </div>
    </div>
  </main>

  <script>

  function setActiveButton(activeId) {
    const submitBtn = document.getElementById('submitBtn');
    const followBtn = document.getElementById('followBtn');
  
    // Reset both buttons
    submitBtn.style.background = '#f4f4f4';
    submitBtn.style.color = '#333';
  
    followBtn.style.background = '#f4f4f4';
    followBtn.style.color = '#333';
  
    // Highlight active button
    const activeBtn = document.getElementById(activeId);
    activeBtn.style.background = '#0066bf';
    activeBtn.style.color = '#fff';
  }

  const proxyURL = "https://inquiry-system-five.vercel.app/api/submit";
  const followupURL = "https://script.google.com/macros/s/AKfycbxX2XkjWrsYRfkKQBotb69wp58nws3SstOL7mvwwrBfG2QIp67tCe36ZbUuQV0qzdza/exec";

  /* ===== MENU SWITCHING ===== */
  function showSection(section) {
    const submit = document.getElementById('submitSection');
    const follow = document.getElementById('followupSection');
    const sBtn = document.getElementById('submitBtn');
    const fBtn = document.getElementById('followBtn');
    if (section === 'submit') {
      submit.style.display = 'block';
      follow.style.display = 'none';
      sBtn.style.background = '#0066bf';
      sBtn.style.color = 'white';
      fBtn.style.background = '#eaeaea';
      fBtn.style.color = '#333';
    } else {
      submit.style.display = 'none';
      follow.style.display = 'block';
      fBtn.style.background = '#0066bf';
      fBtn.style.color = 'white';
      sBtn.style.background = '#eaeaea';
      sBtn.style.color = '#333';
    }
  }

  /* ===== FOLLOW-UP LOGIC ===== */
  async function checkStatus() {
    const id = document.getElementById('followId').value.trim();
    const followup_response_container = document.getElementById('followupResult');
    followup_response_container.innerHTML = '';

    if (!id) {
      followup_response_container.innerHTML = '<p style="color:red;">Please enter your Student ID.</p>';
      return;
    }

  // Show loading indicator
  followup_response_container.innerHTML = '<p style="color:#0066bf; font-weight:600;">Fetching data, please wait...</p>';

    try {
      const res = await fetch(followupURL + "?id=" + encodeURIComponent(id));
      const data = await res.json();

      if (!data || data.length === 0) {
        followup_response_container.innerHTML = '<p style="color:#d32f2f; font-weight:600;">No inquiries found for this ID.</p>';
        return;
      }

      let html = '<h3>Your Inquiries:</h3>';
      data.forEach((d, i) => {
        html += `
          <div style="border:1px solid #ccc; border-radius:6px; padding:10px; margin-top:10px;">
            <p><strong>Inquiry #${i + 1}</strong></p>
            <p><strong>Category:</strong> ${d.category}</p>
            <p><strong>Request Status:</strong> <span style="color:${d.status === 'Pending' ? 'orange' : 'green'}">${d.status}</span></p>
          </div>
        `;
      });
      followup_response_container.innerHTML = html;

    } catch (err) {
      console.error(err);
      followup_response_container.innerHTML = '<p style="color:red;">Error fetching data. Please try again later.</p>';
    }
  }

  /* ===== FOLLOW-UP QUESTIONS LOGIC ===== */
  let courseCount = 1;

  function showFollowupQuestions() {
    const category = document.getElementById('category').value;
    const container = document.getElementById('extraQuestions');
    container.innerHTML = '';

    const labelStyle = 'display:block; font-weight:600; margin-top:12px;';
    const inputStyle = 'width:100%; box-sizing:border-box; padding:10px 12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;';

    if (category === 'Adding_Course') {
      container.innerHTML = `
        <label style="${labelStyle}">Have you added the course to the waiting list?</label>
        <select id="q1" data-label="Added to waiting list?" required  style="${inputStyle}">
          <option value="" selected disabled>Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>

        <label style="${labelStyle}">Course ID</label>
        <input type="text" id="q2" data-label="Course ID" required  style="${inputStyle}">

        <label style="${labelStyle}">Section Requested</label>
        <input type="text" id="q3" data-label="Section Requested" required style="${inputStyle}">
      `;
    } else if (category === 'Section_Change') {
      container.innerHTML = `
        <label style="${labelStyle}">Course ID</label>
        <input type="text" id="q1" data-label="Course ID" required style="${inputStyle}">

        <label style="${labelStyle}">Current Section</label>
        <input type="text" id="q2" data-label="Current Section" required style="${inputStyle}">

        <label style="${labelStyle}">Requested Section</label>
        <input type="text" id="q3" data-label="Requested Section" required style="${inputStyle}">

        <label style="${labelStyle}">Reason for Section Change</label>
        <textarea id="q4" data-label="Reason for change" required style="${inputStyle}"></textarea>
      `;
    } else if (category === 'Diploma_Program') {
      container.innerHTML = `
        <label style="${labelStyle}">Is your advisor listed in SIS?</label>
        <select id="q1" data-label="Advisor appears in SIS?" required style="${inputStyle}">
          <option value="" selected disabled>Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>

        <label style="${labelStyle}">Main Issue</label>
        <select id="q2" data-label="Main Issue" required style="${inputStyle}" onchange="showDiplomaSubQuestions()">
          <option value="">Select</option>
          <option value="courses_equivalence">Course(s) equivalence</option>
          <option value="advisor_not_shown">Don't have an advisor</option>
          <option value="other_issue">Others</option>
        </select>

        <div id="diplomaExtra"></div>
      `;
    } else if (category === 'Exam_Retake') {
      container.innerHTML = `
        <label style="${labelStyle}">Course ID for Exam Retake</label>
        <input type="text" id="q1" data-label="Course ID" required style="${inputStyle}">

        <label style="${labelStyle}">Have you filled the Exam Retake form?</label>
        <select id="q2" data-label="Filled Exam Retake Form?" required style="${inputStyle}">
          <option value="">Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>

        <label style="${labelStyle}">Have you submitted your excuse to the professor?</label>
        <select id="q3" data-label="Submitted Excuse?" required style="${inputStyle}">
          <option value="">Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>

        <label style="${labelStyle}">Professor Name</label>
        <input type="text" id="q4" data-label="Professor Name" required style="${inputStyle}">

        <label style="${labelStyle}">Briefly explain your excuse</label>
        <input type="text" id="q5" data-label="Explain Excuse" required style="${inputStyle}">
      `;
    } else if (category === 'Industrial_Training') {
      container.innerHTML = `
        <label style="${labelStyle}">Main Issue</label>
        <select id="q1" data-label="Main Issue" required style="${inputStyle}">
          <option value="" disabled selected>Select an option</option>
          <option value="training_grade">Need Industrial Training Grade</option>
          <option value="no_training_place">Need place for Industrial Training</option>
          <option value="other_issue">Others</option>
        </select>
      `;
    } else if (category === 'Senior_Project') {
      container.innerHTML = `
        <div style="margin-top:12px;">
          <p style="font-weight:600; color:#0066bf;">Kindly visit the Senior Project Coordinator.</p>
          <p style="font-size:14px; color:#0066bf; margin:6px 0 25px 0;">
            If the Head of Department was your supervisor, send a message on Teams or visit her office after registration week.
          </p>
        </div>
      `;
    }
  }

  function showDiplomaSubQuestions() {
    const issue = document.getElementById('q2').value;
    const diplomaExtra = document.getElementById('diplomaExtra');
    const labelStyle = 'display:block; font-weight:600; margin-top:12px;';
    const inputStyle = 'width:100%; box-sizing:border-box; padding:10px 12px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;';

    if (issue === 'courses_equivalence') {
      courseCount = 1;
      diplomaExtra.innerHTML = `
        <div id="coursesContainer">
          <label style="${labelStyle}">Course ID #${courseCount}</label>
          <input type="text" id="eq1_${courseCount}" data-label="Course ID #${courseCount}" 
           required style="${inputStyle}">
          <label style="${labelStyle}">Equivalent Course ID #${courseCount}</label>
          <input type="text" id="eq2_${courseCount}" data-label="Equivalent Course ID #${courseCount}" 
            required style="${inputStyle}">
        </div>
        <button type="button" id="addCourseBtn" 
          style="margin-top:10px; padding:8px 16px; background-color:#0066bf; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">
          + Add another course
        </button>
      `;
      document.getElementById('addCourseBtn').addEventListener('click', () => {
        courseCount++;
        const container = document.getElementById('coursesContainer');
        const newFields = document.createElement('div');
        newFields.innerHTML = `
          <label style="${labelStyle}">Course ID #${courseCount}</label>
          <input type="text" id="eq1_${courseCount}" data-label="Course ID #${courseCount}" required  style="${inputStyle}">
          <label style="${labelStyle}">Equivalent Course ID #${courseCount}</label>
          <input type="text" id="eq2_${courseCount}" data-label="Equivalent Course ID #${courseCount}" required style="${inputStyle}">
          <button type="button" onclick="this.parentElement.remove()" style="margin-top:8px; background:#ff4d4d; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">Remove Course ID #${courseCount}</button>
        `;
        container.appendChild(newFields);
      });
    } else {
      diplomaExtra.innerHTML = '';
    }
  }

function collectFormData() {
  const data = {
    studentId: document.getElementById('studentId').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    graduate: document.getElementById('graduate').value,
    registered12: document.getElementById('registered12').value,
    category: document.getElementById('category').value,
    details: document.getElementById('details').value.trim(),
    extra: {}
  };

  const extraInputs = document.querySelectorAll('#extraQuestions input, #extraQuestions select, #extraQuestions textarea');
  extraInputs.forEach(el => {
    const label = el.getAttribute('data-label') || el.id; // Use data-label for key
    data.extra[label] = el.value.trim();
  });

  return data;
}

  document.getElementById('inquiryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const status = document.getElementById('statusMsg');
    status.style.color = '#333';
    status.innerText = 'Submitting...';
    try {
      const res = await fetch(proxyURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(collectFormData())
      });
      const json = await res.json();
      if (json.success) {
        status.style.color = 'green';
        status.innerText = 'Inquiry submitted successfully!';
        document.getElementById('inquiryForm').reset();
        document.getElementById('extraQuestions').innerHTML = '';
      } else {
        status.style.color = 'red';
        status.innerText = 'Submission failed. Try again later.';
      }
    } catch (err) {
      console.error(err);
      status.style.color = 'red';
      status.innerText = 'Error submitting form. Check console.';
    }
  });
  </script>
</body>
</html>
