<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inquiry Portal</title>
</head>
<body style="font-family:Arial, Helvetica, sans-serif; background:#f5f7fa; margin:0; padding:0;">

  <!-- Header -->
  <header style="background:#0066bf; color:#fff; padding:18px 12px; text-align:center; font-weight:700; font-size:20px;">
   Inquiry Submission Portal
  </header>

  <!-- Main form container -->
  <main style="padding:24px;">
    <form id="inquiryForm" style="background:#fff; max-width:900px; margin:0 auto; padding:22px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08);">

      <!-- Student ID -->
      <label style="display:block; font-weight:600; margin-top:12px;">Student ID</label>
      <input id="studentId" name="studentId" required
             style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

      <!-- Contact number -->
      <label style="display:block; font-weight:600; margin-top:12px;">Student Contact Number</label>
      <input id="contact" name="contact" required
             style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

      <!-- Graduate? -->
      <label style="display:block; font-weight:600; margin-top:12px;">Graduate Student?</label>
      <select id="graduate" name="graduate" required
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <!-- Registered min 12 hours? -->
      <label style="display:block; font-weight:600; margin-top:12px;">Have you registered minimum 12 hours this semester?</label>
      <select id="registered12" name="registered12" required
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <!-- Category -->
      <label style="display:block; font-weight:600; margin-top:12px;">Inquiry Category</label>
      <select id="category" name="category" required onchange="showFollowupQuestions()"
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="add">Adding Course(s)</option>
        <option value="change">Change Section</option>
        <option value="diploma">Diploma Program</option>
        <option value="retake">Exam Retake</option>
        <option value="training">Industrial Training Grade</option>
        <option value="project">Senior Project</option>
        <option value="other">Other Inquiries</option>
      </select>

      <!-- Container for conditional follow-up questions -->
      <div id="extraQuestions" style="margin-top:14px;"></div>

      <!-- Issue details -->
      <label style="display:block; font-weight:600; margin-top:12px;">Issue Details</label>
      <textarea id="details" name="details" rows="4"
                style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;"
                placeholder="Describe your issue..."></textarea>

      <!-- Submit -->
      <button type="submit"
              style="background:#0066bf; color:#fff; border:none; padding:10px 18px; border-radius:8px; margin-top:18px; cursor:pointer; font-weight:600;">
        Submit Inquiry
      </button>

      <p id="statusMsg" style="margin-top:12px; font-size:14px;"></p>
    </form>
  </main>

<script>
/* ====== Vercel API URL ====== */
const proxyURL = "https://inquiry-system-five.vercel.app/api/submit";

/* Conditional follow-up questions */
function showFollowupQuestions() {
  const category = document.getElementById('category').value;
  const container = document.getElementById('extraQuestions');
  container.innerHTML = '';

  const labelStyle = 'display:block; font-weight:600; margin-top:12px;';
  const inputStyle = 'width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;';

  if (category === 'add') {
    container.innerHTML = `
      <label style="${labelStyle}">Have you added the course to the waiting list?</label>
      <select id="q1" style="${inputStyle}">
        <option value="" selected disabled>Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>

      <label style="${labelStyle}">Course ID</label>
      <input type="text" id="q2" style="${inputStyle}">

      <label style="${labelStyle}">Section Requested</label>
      <input type="text" id="q3" style="${inputStyle}">
    `;
  } else if (category === 'change') {
    container.innerHTML = `
      <label style="${labelStyle}">Course ID</label>
      <input type="text" id="q1" style="${inputStyle}">

      <label style="${labelStyle}">Which section are you currently registered in?</label>
      <input type="text" id="q2" style="${inputStyle}">

      <label style="${labelStyle}">Which section would you like to change to?</label>
      <input type="text" id="q3" style="${inputStyle}">

      <label style="${labelStyle}">What are the reasons for switching to the new section?</label>
      <textarea id="q4" style="${inputStyle}"></textarea>
    `;
  } else if (category === 'diploma') {
    container.innerHTML = `
      <label style="${labelStyle}">Do you see your advisor listed in SIS?</label>
      <select id="q1" style="${inputStyle}">
        <option value="" selected disabled>Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>

      <label style="${labelStyle}">What's your main issue?</label>
      <select id="q2" style="${inputStyle}" onchange="showDiplomaSubQuestions()">
        <option value="">Select</option>
        <option value="equivalence">Course(s) equivalence</option>
        <option value="advisor">Don't have an advisor</option>
        <option value="other">Others</option>
      </select>

      <div id="diplomaExtra"></div>
    `;
  } else if (category === 'retake') {
    container.innerHTML = `
      <label style="${labelStyle}">Have you filled in the Exam Retake form?</label>
      <select id="q1" style="${inputStyle}">
        <option value="">Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>

      <label style="${labelStyle}">Have you submitted your excuse to the Dr?</label>
      <select id="q2" style="${inputStyle}">
        <option value="">Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>

      <label style="${labelStyle}">Course ID for Exam Retake</label>
      <input type="text" id="q3" style="${inputStyle}">
    `;
  } else if (category === 'training') {
    container.innerHTML = `
      <label style="${labelStyle}">Do you need the Industrial Training grade?</label>
      <select id="q1" style="${inputStyle}">
        <option value="">Select</option>
        <option>Yes</option>
        <option>No</option>
      </select>

      <label style="${labelStyle}">Others</label>
      <textarea id="q2" style="${inputStyle}"></textarea>
    `;
  } else if (category === 'project') {
    container.innerHTML = `
      <p><strong>Kindly visit Dr. Reham, the Senior Project Coordinator.</strong></p>
    `;
  }
}

function showDiplomaSubQuestions() {
  const issue = document.getElementById('q2').value;
  const diplomaExtra = document.getElementById('diplomaExtra');
  diplomaExtra.innerHTML = '';

  const labelStyle = 'display:block; font-weight:600; margin-top:12px;';
  const inputStyle = 'width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;';

  if (issue === 'equivalence') {
    diplomaExtra.innerHTML = `
      <label style="${labelStyle}">Course ID</label>
      <input type="text" id="eq1" style="${inputStyle}">
      
      <label style="${labelStyle}">Equivalent ID</label>
      <input type="text" id="eq2" style="${inputStyle}">
    `;
  } else if (issue === 'other') {
    diplomaExtra.innerHTML = `
      <label style="${labelStyle}">Please describe:</label>
      <textarea id="eq3" style="${inputStyle}"></textarea>
    `;
  }
}

/* Collect form data */
function collectFormData() {
  const data = {
    studentId: document.getElementById('studentId').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    graduate: document.getElementById('graduate').value,
    registered12: document.getElementById('registered12').value,
    category: document.getElementById('category').value,
    details: document.getElementById('details').value.trim(),
    extra: {}
  };

  // Collect all dynamically generated fields
  const extraInputs = document.querySelectorAll('#extraQuestions input, #extraQuestions select, #extraQuestions textarea');
  extraInputs.forEach((el, index) => {
    data.extra[`q${index + 1}`] = el.value.trim();
  });

  return data;
}
  
/* Submit via Vercel serverless function */
document.getElementById('inquiryForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const statusMsg = document.getElementById('statusMsg');

  if(!document.getElementById('studentId').value.trim()){
    statusMsg.style.color = 'crimson'; 
    statusMsg.textContent = 'Please enter Student ID.';
    return;
  }

  statusMsg.style.color = '#333';
  statusMsg.textContent = 'Submitting...';

  const payload = collectFormData();

  try {
    const res = await fetch(proxyURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if(res.ok){
      statusMsg.style.color = 'green';
      statusMsg.textContent = 'Inquiry submitted successfully!';
      this.reset();
      document.getElementById('extraQuestions').innerHTML = '';
    } else {
      const txt = await res.text();
      statusMsg.style.color = 'crimson';
      statusMsg.textContent = 'Submission failed. Server returned an error.';
      console.error('Server error response:', txt);
    }
  } catch(err){
    console.error(err);
    statusMsg.style.color = 'crimson';
    statusMsg.textContent = 'Submission failed. See console for details.';
  }
});
</script>

</body>
</html>
