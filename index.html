<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inquiry Portal</title>
</head>
<body style="font-family:Arial, Helvetica, sans-serif; background:#f5f7fa; margin:0; padding:0;">

  <!-- Header -->
  <header style="background:#0066bf; color:#fff; padding:18px 12px; text-align:center; font-weight:700; font-size:20px;">
   Inquiry Submission Portal
  </header>

  <!-- Main form container -->
  <main style="padding:24px;">
    <form id="inquiryForm" style="background:#fff; max-width:900px; margin:0 auto; padding:22px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.08);">

      <!-- Student ID -->
      <label style="display:block; font-weight:600; margin-top:12px;">Student ID</label>
      <input id="studentId" name="studentId" required
             style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

      <!-- Contact number -->
      <label style="display:block; font-weight:600; margin-top:12px;">Student Contact Number</label>
      <input id="contact" name="contact" required
             style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;" />

      <!-- Graduate? -->
      <label style="display:block; font-weight:600; margin-top:12px;">Graduate Student?</label>
      <select id="graduate" name="graduate" required
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <!-- Registered min 12 hours? -->
      <label style="display:block; font-weight:600; margin-top:12px;">Have you registered minimum 12 hours this semester?</label>
      <select id="registered12" name="registered12" required
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="Yes">Yes</option>
        <option value="No">No</option>
      </select>

      <!-- Category -->
      <label style="display:block; font-weight:600; margin-top:12px;">Inquiry Category</label>
      <select id="category" name="category" required onchange="showFollowupQuestions()"
              style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;">
        <option value="">Select</option>
        <option value="add">Adding Course(s)</option>
        <option value="change">Change Section</option>
        <option value="diploma">Diploma Program</option>
        <option value="retake">Exam Retake</option>
        <option value="training">Industrial Training Grade</option>
        <option value="project">Senior Project</option>
        <option value="other">Other Inquiries</option>
      </select>

      <!-- Container for conditional follow-up questions -->
      <div id="extraQuestions" style="margin-top:14px;"></div>

      <!-- Extra details -->
      <label style="display:block; font-weight:600; margin-top:12px;">Extra Issue Details</label>
      <textarea id="details" name="details" rows="4"
                style="width:100%; padding:10px; margin-top:6px; border:1px solid #ccc; border-radius:6px; font-size:14px;"
                placeholder="Describe your issue..."></textarea>

      <!-- Submit -->
      <button type="submit"
              style="background:#0066bf; color:#fff; border:none; padding:10px 18px; border-radius:8px; margin-top:18px; cursor:pointer; font-weight:600;">
        Submit Inquiry
      </button>

      <p id="statusMsg" style="margin-top:12px; font-size:14px;"></p>
    </form>
  </main>

<script>
/* ====== Vercel API URL ====== */
const proxyURL = "https://inquiry-system-five.vercel.app/api/submit"; // Replace with your actual Vercel endpoint

/* Conditional follow-up questions */
function showFollowupQuestions(){
  const c = document.getElementById('category').value;
  const container = document.getElementById('extraQuestions');
  container.innerHTML = '';

  if(c === 'add'){
    container.innerHTML = `
      <label style="display:block; font-weight:600; margin-top:10px;">Have you added the course to the waiting list?</label>
      <select id="add_waitlist" name="add_waitlist" style="width:100%; padding:8px; margin-top:6px; border-radius:6px;">
        <option value="Yes">Yes</option><option value="No">No</option>
      </select>

      <label style="display:block; font-weight:600; margin-top:10px;">Course ID</label>
      <input id="add_course" name="add_course" style="width:100%; padding:8px; margin-top:6px; border-radius:6px;" />

      <label style="display:block; font-weight:600; margin-top:10px;">Section Requested</label>
      <input id="add_section" name="add_section" style="width:100%; padding:8px; margin-top:6px; border-radius:6px;" />
    `;
  } 
  // You can add other categories as before
}

/* Collect form data */
function collectFormData(){
  const data = {
    studentId: document.getElementById('studentId').value.trim(),
    contact: document.getElementById('contact').value.trim(),
    graduate: document.getElementById('graduate').value,
    registered12: document.getElementById('registered12').value,
    category: document.getElementById('category').value,
    details: document.getElementById('details').value.trim(),
    extra: {}
  };

  if(data.category === 'add'){
    data.extra.waitlist = document.getElementById('add_waitlist')?.value || '';
    data.extra.courseId = document.getElementById('add_course')?.value || '';
    data.extra.section = document.getElementById('add_section')?.value || '';
  }

  return data;
}

/* Submit via Vercel serverless function */
document.getElementById('inquiryForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const statusMsg = document.getElementById('statusMsg');

  if(!document.getElementById('studentId').value.trim()){
    statusMsg.style.color = 'crimson'; 
    statusMsg.textContent = 'Please enter Student ID.';
    return;
  }

  statusMsg.style.color = '#333';
  statusMsg.textContent = 'Submitting...';

  const payload = collectFormData();

  try {
    const res = await fetch(proxyURL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if(res.ok){
      statusMsg.style.color = 'green';
      statusMsg.textContent = 'Inquiry submitted successfully!';
      this.reset();
      document.getElementById('extraQuestions').innerHTML = '';
    } else {
      const txt = await res.text();
      statusMsg.style.color = 'crimson';
      statusMsg.textContent = 'Submission failed. Server returned an error.';
      console.error('Server error response:', txt);
    }
  } catch(err){
    console.error(err);
    statusMsg.style.color = 'crimson';
    statusMsg.textContent = 'Submission failed. See console for details.';
  }
});
</script>

</body>
</html>
